function Core_URI(){}Core_URI.prototype={PROTOCOL_NONE:"none",PROTOCOL_HTTP:"http",PROTOCOL_HTTPS:"https",PROTOCOL_EITHER:"either",redirect:function(t,s){window.location="boolean"==typeof s?this.urlize(t):t},urlize:function(t){return $core.isUndefined($core.options.uri.base_url)?void $core.log("Base URL not set."):$core.options.uri.base_url+t},formatURI:function(t,s,i){return s=s||this.PROTOCOL_EITHER,i=i||!1,i===!1?s===this.PROTOCOL_HTTPS?"https://"!==t.substring(0,8)&&(t="https://"+t):s===this.PROTOCOL_HTTP?"http://"!==t.substring(0,7)&&(t="http://"+t):s===this.PROTOCOL_EITHER&&"https://"!==t.substring(0,8)&&"http://"!==t.substring(0,7)&&(t="http://"+t):"http://"!==t.substring(0,7)?t=t.substring(7):"https://"!==t.substring(0,8)&&(t=t.substring(8)),t}};
function Core_Ajax_Request(){}Core_Ajax_Request.prototype={$form:null,url:"",data:{},method:"GET",data_type:"json",cache:!1,async:!0,result:null,before:null,progress:null,success:null,error:null,always:null,abort:null,execute:function(){var e=this;if($core.isUndefined(e.url))return void $core.log("Missing AJAX URL.");$core.isUndefined($core.ajax.requests[e.url])||$core.ajax.requests[e.url].abort();var r=$core.isDefined(e.file_upload)&&e.file_upload===!0,o={"X-XSRF-TOKEN":$core.options.csrf_token};r===!0&&$core.isObject(e.file_upload_data)&&(o=$.extend(o,e.file_upload_data)),$core.ajax.requests[e.url]=$.ajax({type:e.method,url:e.url,data:e.data,dataType:e.data_type,cache:e.cache,async:e.async,processData:r!==!0,contentType:r===!0?!1:"application/x-www-form-urlencoded; charset=UTF-8",headers:o,xhr:function(){var r=$.ajaxSettings.xhr();return $core.isFunction(e.progress)&&(r.upload.onprogress=function(r){var o=r.loaded/r.total*100;e.progress(o)}),r},beforeSend:function(r,o){$core.isFunction(e.before)&&e.before(r,o)}}).done(function(r){$core.isFunction(e.success)&&e.success(r),"undefined"!=typeof r.message&&null!==r.message&&"number"==typeof r.message.type&&"string"==typeof r.message.text&&$core.ui.message.engine.show(r.message.type,r.message.text),$core.isUndefined(r.redirect)||setTimeout(function(){return $core.uri.redirect(r.redirect.url)},r.redirect.delay),e.result=r}).always(function(r){$core.isFunction(e.always)&&e.always(r),delete $core.ajax.requests[e.url]}).fail(function(r,o,t){"abort"===r?$core.isFunction(e.abort)&&e.abort():$core.isFunction(e.error)&&e.error(t)})}};
function Core_Ajax(){}Core_Ajax.prototype={requests:[],get:function(e,r,o,s){var c=new Core_Ajax_Request;if(c.method="GET",c.url=e,c.data=r,$core.isUndefined(o)&&(o={}),$core.isFunction(o.before)&&(c.before=o.before),$core.isFunction(o.progress)&&(c.progress=o.progress),$core.isFunction(o.success)&&(c.success=o.success),$core.isFunction(o.error)&&(c.error=o.error),$core.isFunction(o.always)&&(c.always=o.always),$core.isFunction(o.abort)&&(c.abort=o.abort),$core.isObject(s))for(var n in s)s.hasOwnProperty(n)&&(c[n]=s[n]);c.execute()},post:function(e,r,o,s){var c=new Core_Ajax_Request;if(c.method="POST",c.url=e,c.data=r,$core.isUndefined(o)&&(o={}),$core.isFunction(o.before)&&(c.before=o.before),$core.isFunction(o.progress)&&(c.progress=o.progress),$core.isFunction(o.success)&&(c.success=o.success),$core.isFunction(o.error)&&(c.error=o.error),$core.isFunction(o.always)&&(c.always=o.always),$core.isFunction(o.abort)&&(c.abort=o.abort),$core.isObject(s))for(var n in s)s.hasOwnProperty(n)&&(c[n]=s[n]);c.execute()}};
function Core_UI_Dialog(){}Core_UI_Dialog.prototype={default_options:{modes:null,title:null,width:640,height:480,modal:!1,autoOpen:!1,closeButton:!0,loadingText:"Loading",savingText:"Saving",getURL:null,getData:null,saveURL:null,saveData:null,closeAfterSave:!0,verticalPadding:20,horizontalPadding:18,headerHeight:40,buttonsContainerHeight:40,buttons:[],afterLoaded:null,afterSaved:null},mask_id:"core_dialog_mask",$mask:null,dialogs:{},current_dialog_id:null,init:function(){var e=this;$("body").on("keyup",function(t){27===t.which&&null!==e.current_dialog&&$core.isDefined(e.dialogs[e.current_dialog_id])&&e.dialogs[e.current_dialog_id].close()})},create:function(e){var t=this,o=$core.getObjectSize(t.dialogs)+1;if("object"!=typeof e)return void $core.log("Missing options for dialog.");for(var n in t.default_options)t.default_options.hasOwnProperty(n)&&!e.hasOwnProperty(n)&&(e[n]=t.default_options[n]);var i={id:o,selector:"#core_dialog_"+o,$dialog:null,$loader:null,$loader_text:null,$header:null,$content:null,$buttons_container:null,$buttons:null,default_line_height:null,mode:null,options:e,setMode:function(e){var t=this;return"undefined"==typeof t.options.modes[e]?($core.log('Invalid dialog mode "'+e+'".'),!1):(t.mode=e,"undefined"!=typeof t.options.modes[e].title&&t.setTitle(t.options.modes[e].title),!0)},getMode:function(){return i.mode},setTitle:function(e){this.$header.querySelector(".core-dialog-header-title").innerHTML=e},open:function(e){var n=this;if(null!==e&&n.setMode(e)===!1)return!1;n.options.modal===!0&&0===$("#"+t.mask_id).length&&($("body").append('<div id="'+t.mask_id+'" class="open"></div>'),t.$mask=$("#"+t.mask_id),t.$mask.on("click",function(){n.close()})),n.showLoader(n.options.loadingText),n.$dialog.classList.add("open"),$("body").append(n.$dialog);var s,a=n.getButtons(),l="";for(s in a){var d=a[s];l+=d.html}n.$buttons.innerHTML=l;for(s in a){var d=a[s];$core.isFunction(d.click)&&!function(e){$(e.selector).on("click",function(){e.click(e)===!1})}(d)}$(n.selector).find(".core-dialog-close-button").on("click",function(){n.close()}),t.current_dialog_id=o,$core.ajax.get(n.options.getURL,n.options.getData,{success:function(e){n.$content.innerHTML=e.data.html,[].forEach.call(n.$content.querySelectorAll("input"),function(e){e.addEventListener("keyup",function(e){return 13===(e.keyCode||e.which)?!1:void 0},!1)}),i.$content.style.lineHeight=i.default_line_height,n.hideLoader(),n.enableButtons(),$core.isFunction(n.options.afterLoaded)&&n.options.afterLoaded(!0,e)},error:function(e){n.setError("Could not load dialog."),n.hideLoader(),n.enableButtons(!0),$core.isFunction(n.options.afterLoaded)&&n.options.afterLoaded(!1,e)}})},close:function(){var e=this;e.$dialog.classList.add("close"),$(e.selector).one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){e.$dialog.classList.remove("close"),e.$content.classList.remove("error"),$(e.selector).remove()}),e.options.modal===!0&&(t.$mask.removeClass("open").addClass("close"),t.$mask.one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){null!==t.$mask&&(t.$mask.remove(),t.$mask=null)})),t.current_dialog_id=null},getButton:function(e){if(null!==this.options.modes){var t=this.mode;for(var o in this.options.modes[t].buttons)if(this.options.modes[t].buttons[o].id===e)return this.options.modes[t].buttons[o]}else for(var n=0;h>n;n++)if(this.options.buttons[n].id===e)return this.options.buttons[n];return null},getButtons:function(){return null!==this.options.modes?this.options.modes[i.mode].buttons:this.options.buttons},enableButtons:function(e){$core.isUndefined(e)&&(e=!1);var t=this.getButtons();for(var o in t){var n=t[o];(e===!1||e===!0&&"undefined"!=typeof n.save&&n.save===!1)&&$(n.selector).removeClass("disabled")}},disableButtons:function(e){$core.isUndefined(e)&&(e=!1);var t=this.getButtons();for(var o in t){var n=t[o];e===!1||e&&"undefined"!=typeof n.save&&n.save===!0?$(n.selector).addClass("disabled"):$(n.selector).removeClass("disabled")}},resetButtons:function(){var e=this.getButtons();for(var t in e){var o=e[t];$(o.selector).html(o.text).removeClass("disabled")}},showLoader:function(e){$core.isUndefined(e)&&(e=this.options.loadingText),i.$dialog.classList.add("loading"),i.$content.style.lineHeight=i.$content.style.height,i.$loader_text.innerHTML=e,i.$loader.style.display="block"},setLoaderText:function(e){i.$loader_text.innerHTML=e},hideLoader:function(){i.$dialog.classList.remove("loading"),i.$loader.style.display="none"},save:function(e){var t=this;t.showLoader(t.options.savingText),t.disableButtons(),"undefined"==typeof e._token&&(e._token=$core.options.csrf_token),$core.ajax.post(t.options.saveURL,e,{success:function(){$core.isFunction(t.options.afterSaved)&&t.options.afterSaved(),t.options.closeAfterSave===!0&&t.close()},error:function(){t.setError("Could not save promo.")},always:function(){t.hideLoader(),t.options.closeAfterSave===!1&&t.enableButtons()}})},setError:function(e){this.$content.style.lineHeight=i.$content.style.height,this.$content.className="core-dialog-content error",this.$content.innerHTML=e,this.disableButtons(!0)},setGetData:function(e){this.options.getData=e},getGetData:function(e){return this.options.getData[e]}},s=i.options.height-2*i.options.verticalPadding-i.options.headerHeight-i.options.buttonsContainerHeight;i.$loader=document.createElement("div"),i.$loader.className="ui segment core-dialog-loader-container",i.$loader.style.height=s+"px";var a=document.createElement("div");a.className="ui active inverted dimmer",i.$loader_text=document.createElement("div"),i.$loader_text.setAttribute("id","core_dialog_"+i.id+"_loader_text");var l;l=i.options.height>640?"large":i.options.height>480?"medium":"small",i.$loader_text.className="ui "+l+" text loader",i.$loader_text.innerHTML=i.options.loadingText,a.appendChild(i.$loader_text),i.$loader.appendChild(a),i.$header=document.createElement("div"),i.$header.className="core-dialog-header",i.$header.style.height=i.options.headerHeight+"px",i.$header.innerHTML='<div class="core-dialog-header-title">'+i.options.title+"</div>"+(i.options.closeButton===!0?'<div class="core-dialog-header-buttons"><a href="javascript:" class="core-dialog-close-button"><i class="remove icon"></i></a></div>':""),i.$content=document.createElement("div"),i.$content.className="core-dialog-content",i.$content.style.height=s+"px",i.$buttons_container=document.createElement("div"),i.$buttons_container.className="core-dialog-buttons-container",i.$buttons_container.style.height=i.options.buttonsContainerHeight+"px",i.$buttons=document.createElement("div"),i.$buttons.className="core-dialog-buttons";var d=function(e){return e.selector="#dialog_"+i.id+"_button_"+(u+1),e.html='<a href="javascript:" id="'+e.selector.substring(1)+'" class="ui button tiny disabled'+("undefined"!=typeof e.save&&e.save===!0?" blue":"")+'">'+e.text+"</a>",function(e){e.setText=function(t){return $(e.selector).html(t),e},e.setLoadingText=function(){e.setText(e.loadingText)},e.enable=function(){return $(e.selector).removeClass("disabled"),e},e.disable=function(){return $(e.selector).addClass("disabled"),e},e.spin=function(){return $(e.selector).addClass("loading"),e},e.stopSpin=function(){return $(e.selector).removeClass("loading"),e}}(e,u),e};if(null!==i.options.modes)for(var r in i.options.modes){var c=i.options.modes[r];if($core.isDefined(c.buttons))for(var u=0,h=c.buttons.length;h>u;u++)i.options.modes[r].buttons[u]=d(i.options.modes[r].buttons[u])}else for(var u=0,h=e.buttons.length;h>u;u++)i.options.buttons[u]=d(i.options.buttons[u]);i.$buttons_container.appendChild(i.$buttons);var p=document.createElement("div");return p.className="core-dialog",p.setAttribute("id","core_dialog_"+i.id),p.style.width=i.options.width+"px",p.style.height=i.options.height+"px",p.style.marginTop=-(i.options.height/2)+"px",p.style.marginLeft=-(i.options.width/2)+"px",p.style.padding=i.options.verticalPadding+"px "+i.options.horizontalPadding+"px",p.appendChild(i.$loader),p.appendChild(i.$header),p.appendChild(i.$loader),p.appendChild(i.$content),p.appendChild(i.$buttons_container),i.default_line_height=i.$content.style.lineHeight,i.$dialog=p,t.dialogs[i.id]=i,i}};
function Core_UI_Message_Engine_SweetAlert(){}Core_UI_Message_Engine_SweetAlert.prototype={core_ui_message:null,show:function(e,_,c){var s=null,i=!1;e===this.core_ui_message.MESSAGE_TYPE_SUCCESS?s="success":e===this.core_ui_message.MESSAGE_TYPE_INFO?s="info":e===this.core_ui_message.MESSAGE_TYPE_WARNING?s="warning":e===this.core_ui_message.MESSAGE_TYPE_ERROR?s="error":e===this.core_ui_message.MESSAGE_TYPE_CONFIRM&&(i=!0),swal({title:"",text:_,type:s,showCancelButton:i},function(e){$core.isDefined(c)&&(e===!0&&$core.isFunction(c.confirm_callback)?c.confirm_callback():e===!1&&$core.isFunction(c.cancel_callback)&&c.cancel_callback())})}};
function Core_UI_Message_Engine_Noty(){}Core_UI_Message_Engine_Noty.prototype={core_ui_message:null,show:function(e,_){var s=null,t=!1;e===this.core_ui_message.MESSAGE_TYPE_SUCCESS?s="alert":e===this.core_ui_message.MESSAGE_TYPE_INFO?s="alert":e===this.core_ui_message.MESSAGE_TYPE_WARNING?s="warning":e===this.core_ui_message.MESSAGE_TYPE_ERROR?s="error":e===this.core_ui_message.MESSAGE_TYPE_CONFIRM&&(t=!0),noty({layout:"topRight",type:s,text:_,timeout:2e3,maxVisible:1})}};
function Core_UI_Message(){}Core_UI_Message.prototype={MESSAGE_TYPE_DEFAULT:1,MESSAGE_TYPE_SUCCESS:2,MESSAGE_TYPE_INFO:3,MESSAGE_TYPE_WARNING:4,MESSAGE_TYPE_ERROR:5,MESSAGE_TYPE_CONFIRM:6,engine:null,init:function(){$core.isDefined($core.options.message.engine)&&this.setEngine($core.options.message.engine)},afterDomInit:function(){"undefined"!=typeof core_message&&this.engine.show(core_message.type,core_message.text)},setEngine:function(e){this.engine=e,this.engine.core_ui_message=this},success:function(e,n){this.engine.show(this.MESSAGE_TYPE_SUCCESS,e,n)},info:function(e,n){this.engine.show(this.MESSAGE_TYPE_INFO,e,n)},warning:function(e,n){this.engine.show(this.MESSAGE_TYPE_WARNING,e,n)},error:function(e,n){this.engine.show(this.MESSAGE_TYPE_ERROR,e,n)},confirm:function(e,n,i,s){$core.isUndefined(s)&&(s={}),s.confirm_callback=n,s.cancel_callback=i,this.engine.show(this.MESSAGE_TYPE_CONFIRM,e,s)}};
function Core_UI(){}Core_UI.prototype={message:null,dialog:null,init:function(){this.message=new Core_UI_Message,this.message.init(),this.dialog=new Core_UI_Dialog,this.dialog.init()},afterDomInit:function(){this.message.afterDomInit()},setCaretAtEnd:function(e){var t=e.value.length;if(document.selection){e.focus();var n=document.selection.createRange();n.moveStart("character",-t),n.moveStart("character",t),n.moveEnd("character",0),n.select()}else(e.selectionStart||0===e.selectionStart)&&(e.selectionStart=t,e.selectionEnd=t,e.focus())},viewport:function(){var e=window,t="inner";return"innerWidth"in window||(t="client",e=document.documentElement||document.body),{width:e[t+"Width"],height:e[t+"Height"]}}};
function Core_Form_File_Upload(){}Core_Form_File_Upload.prototype={PROGRESS_BAR_TYPE_DIALOG:1,PROGRESS_BAR_TYPE_CUSTOM:2,PROGRESS_BAR_TYPE_DYNAMIC_ITEM:3,default_options:{saveURL:null,progressBarType:2,progressBarDialog:null,progressBarContainerSelector:null,progressBarKeyword:null,maxFileSize:"2",allowedFileTypes:null,data:{},onStart:null,onProgress:null,onComplete:null,onAlways:function(){},onError:null},file_uploads:{},init:function(o,e){var r=this;for(var s in r.default_options)r.default_options.hasOwnProperty(s)&&!e.hasOwnProperty(s)&&(e[s]=r.default_options[s]);if(r.file_uploads[o]={$element:document.querySelector(o),options:e,$progressBarContainer:null},null===r.file_uploads[o].$element)return void $core.log('Could not find file upload element "'+this.selector+'".');if(null===r.file_uploads[o].options.saveURL)return void $core.log('Missing required option "saveURL".');if(r.file_uploads[o].options.progressBarType===r.PROGRESS_BAR_TYPE_DIALOG){if(null===r.file_uploads[o].options.progressBarDialog)return void $core.log("No progress bar dialog defined.")}else if(r.file_uploads[o].options.progressBarType===r.PROGRESS_BAR_TYPE_CUSTOM){if(null===r.file_uploads[o].options.progressBarContainerSelector)return void $core.log("No progress bar selector defined.");var i=document.querySelector(r.file_uploads[o].options.progressBarContainerSelector);if(null===i)return void $core.log('Could not find file upload progress bar container "'+r.file_uploads[o].options.progressBarContainerSelector+'".');i.innerHTML='<div class="ui small progress"><div class="bar"><div class="progress"></div></div><div class="label"></div></div>',$(r.file_uploads[o].options.progressBarContainerSelector).find(".progress").progress({percent:0}),r.file_uploads[o].$progressBarContainer=document.querySelector(r.file_uploads[o].options.progressBarContainerSelector),r.file_uploads[o].$element.addEventListener("change",function(){r.file_uploads[o].$progressBarContainer.style.display="block",r.checkFileSize(o)===!0&&r.checkFileType(o)===!0&&r.clearError(o)},!1)}return{start:function(){var e=this,s=$(o)[0].files,i=r.file_uploads[o];if(0===s.length)return $core.log("No file to upload."),void i.options.onAlways();if(s.length>1)return $core.log("More than one file selected."),void i.options.onAlways();var n=s[0];i.options.data.mime=n.type,$core.isFunction(i.options.onStart)&&r.file_uploads[o].options.onStart(),i.options.progressBarType===r.PROGRESS_BAR_TYPE_DIALOG&&i.options.progressBarDialog.showLoader("Start uploading of "+i.options.progressBarKeyword+"..."),$core.ajax.post(i.options.saveURL,n,{progress:function(o){i.options.progressBarType===r.PROGRESS_BAR_TYPE_DIALOG?i.options.progressBarDialog.setLoaderText("Uploading "+i.options.progressBarKeyword+" ("+o+"%)..."):i.options.progressBarType===r.PROGRESS_BAR_TYPE_CUSTOM?($(i.options.progressBarContainerSelector).find(".progress").progress({percent:o}),$core.isFunction(i.options.onProgress)&&i.options.onProgress(o)):i.options.progressBarType===r.PROGRESS_BAR_TYPE_DYNAMIC_ITEM},success:function(){$core.isFunction(i.options.onComplete)&&i.options.onComplete(),i.options.onAlways()},error:function(){r.throwError(o,'Could not save image (<a href="javascript:" class="core-file-upload-retry-button">retry</a>).'),$(i.options.progressBarContainerSelector).find(".core-file-upload-retry-button").on("click",function(){$(i.options.progressBarContainerSelector).find(".progress").progress({percent:0}),e.start()}),$core.isFunction(i.options.onError)&&i.options.onError(),i.options.onAlways()}},{file_upload:!0,file_upload_data:i.options.data})},addData:function(e,s){r.file_uploads[o].options.data[e]=s}}},checkFileSize:function(o){var e=$(o)[0].files[0];return e.size>post_max_size?(this.throwError(o,"File ("+$core.formatSize(e.size)+") is larger than server post max size ("+$core.formatSize(post_max_size)+")."),!1):e.size>upload_max_filesize?(this.throwError(o,"File ("+$core.formatSize(e.size)+") is larger than server max upload file size ("+$core.formatSize(upload_max_filesize)+")."),!1):!0},checkFileType:function(o){var e=this,r=e.file_uploads[o].options.allowedFileTypes;if(null===r)return!0;var s=$(o)[0].files[0];return $core.inArray(s.type,r)?!0:(this.throwError(o,"Selected file type ("+s.type+") is not valid ("+$core.implode(", ",r)+")."),!1)},throwError:function(o,e){var r=this,s=$(r.file_uploads[o].options.progressBarContainerSelector),i=s.find(".label");s.find(".progress").addClass("error"),i.html(e)},clearError:function(o){var e=this,r=$(e.file_uploads[o].options.progressBarContainerSelector),s=r.find(".label");r.find(".progress").removeClass("error"),s.html("")}};
function Core_Form(){}Core_Form.prototype={file_upload:null,init:function(){this.file_upload=new Core_Form_File_Upload}};
function Core_DynamicTable(){}Core_DynamicTable.prototype={container_selector:"#dynamic_table_container",search_input_selector:"#dynamic_table_search",$container:null,$paging_containers:null,$search_input:null,search_query:"",searching:!1,loading_html:null,current_page:1,num_pages:null,init:function(){if("object"==typeof dynamic_table){if(this.$container=$(this.container_selector),0===this.$container.length)return void $core.log('Could not find dynamic table element "'+this.container_selector+'".');if("undefined"==typeof dynamic_table.urls)return this.show_error(),void $core.log('Required attribute "urls" is not defined.');this.loading_html=this.$container.html(),this.refresh(!0)}},refresh:function(e){var n=this;e===!1&&this.show_loader();var t={};dynamic_table.paging.enabled===!0&&(t.page=n.current_page),dynamic_table.search.enabled===!0&&(t.search_query=n.search_query),$core.ajax.get(dynamic_table.urls.get,t,{success:function(e){$(e.data.html).imagesLoaded().always(function(){n.$container.html(e.data.html),dynamic_table.paging.enabled===!0&&(n.current_page=e.data.paging.current_page,n.num_pages=e.data.paging.num_pages),n.binds()})},error:function(){n.show_error()}})},show_loader:function(){this.$container.html(this.loading_html)},show_error:function(){this.$container.html("Could not load "+dynamic_table.identifier.plural+".")},binds:function(e){var n=this,t=$core.isDefined(e)?$("#dynamic_table_item_"+e):n.$container;t.find(".manage-dropdown").dropdown($core.options.dynamic_table.manage_dropdown_settings),t.find(".delete-button").on("click",function(e){e.preventDefault();var t=$(this),a=t.closest("tr"),i=a.data("id"),r=a.data("title"),c=t.attr("href");$core.ui.message.confirm("Are you sure you want to delete "+dynamic_table.identifier.singular+' "'+r+'"?',function(){var e=$("#dynamic_table_item_"+i),t=e.html();e.html('<td colspan="'+$core.getObjectSize(dynamic_table.table_columns)+'">Deleting...</td>'),$core.ajax.post(c,{id:i,_token:csrf_token},{success:function(){n.refresh(!1),$core.ui.message.success(dynamic_table.identifier.singular+' "'+r+'" was deleted.')},error:function(){$core.ui.message.error("Could not delete "+dynamic_table.identifier.singular+' "'+r+'".'),e.html(t),n.binds(i)}})})}),dynamic_table.paging.enabled===!0&&(n.$paging_containers=n.$container.find(".pagination"),n.$paging_containers.find(".prev:not(.disabled)").on("click",function(){n.current_page--,n.refresh(!1)}),n.$paging_containers.find(".next:not(.disabled)").on("click",function(){n.current_page++,n.refresh(!1)})),dynamic_table.search.enabled===!0&&(n.$search_input=$(n.search_input_selector),n.searching===!0&&($core.ui.setCaretAtEnd(document.querySelector(n.search_input_selector)),n.searching=!1),0===n.$search_input.length?$core.log("Could not find dynamic table search input "+n.search_input_selector+"."):n.$search_input.on("keyup",function(e){13===(e.keyCode||e.which)&&(n.search_query=n.$search_input.val(),n.searching=!0,n.refresh(!1))}))}};
function Core_DynamicItem(){}Core_DynamicItem.prototype={form_selector:"#dynamic_item_form",$form:null,loader_selector:"#dynamic_item_form_loader",$loader:null,$loader_text:null,tabs_selector:"#dynamic_item_tabs",$tabs:null,save_button_selector:"#dynamic_item_save_button",$save_button:null,types_with_custom_saving:["image"],init:function(){var e=this;if(e.$form=$(e.form_selector),e.$form.on("submit",function(){return!1}),e.$loader=$(e.loader_selector),e.$loader_text=e.$loader.children(".text"),e.$save_button=$(e.save_button_selector),e.$save_button.attr("data-default_text",e.$save_button.text()),1===e.$form.length){e.$form.find(".image-card-replace-button").on("click",function(){var e=$(this),t=e.parents(".image-card").find(".image-card-file-input");t.on("change",function(){var i=e.parents(".field").data("id"),a="cancel_replace_"+i,o=e.closest(".ui.buttons"),r=e.parents(".extra").find(".image-card-status-text");o.hide(),r.html(this.files[0].name+' <a href="javascript:" id="'+a+'">(Cancel)</a>').show(),$("#"+a).on("click",function(){t.val(""),r.hide().html(""),o.show()})}),t.trigger("click")}),e.$form.find(".image-card-delete-button").on("click",function(){var t=$(this),i=t.parents(".field").data("id"),a="delete_"+i;t.hasClass("active")?($("#"+a).remove(),t.removeClass("active")):(e.$form.prepend('<input type="hidden" name="items_to_delete[]" id="'+a+'" value="'+i+'">'),t.addClass("active"))});var t={},i=[];for(var a in dynamic_item_columns)if(dynamic_item_columns.hasOwnProperty(a)){dynamic_item_columns[a].id=a;var o=dynamic_item_columns[a],r=[];if($core.inArray(o.form.type,e.types_with_custom_saving)&&i.push(o),"object"==typeof o.form.validation){if("number"==typeof o.form.validation.required&&(o.form.validation.required===ALWAYS_REQUIRED||null===item_id_to_edit&&o.form.validation.required===REQUIRED_ON_ADD)){var n="";n="select"===o.form.type?"Choose a "+o.title.toLowerCase():o.title+" is required",r.push({type:"empty",prompt:n})}"number"==typeof o.form.maxlength&&r.push({type:"maxLength["+o.validation.maxlength+"]",prompt:"Name can't be longer than "+o.validation.maxlength+" character"+(1!==o.validation.maxlength?"s":"")})}t[a]={identifier:a,rules:r}}var s=i.length;e.$form.form(t,{inline:!0,onSuccess:function(){"string"==typeof e.$save_button.data("loading_text")&&e.$save_button.text(e.$save_button.data("loading_text")),e.$save_button.prop("disabled",!0),e.$loader.show();var t=s>0,a=e.$form.find(":input").serialize();return a+="&have_custom_saving_columns="+(t===!0?"yes":"no"),$core.ajax.post(e.$form.attr("action"),a,{success:function(t){for(var a=null!==item_id_to_edit?item_id_to_edit:t.data.added_item_id,o=[],r=0,n=i.length;n>r;r++){var s=i[r],d=$('[name="'+s.form.name+'"]');1===d.length&&""!==d.val()&&o.push(i[r])}var l=o.length,c=l>0,m=c?o[0]:null;e.setLoaderText($core.ucfirst(dynamic_item_options.identifier.singular)+" "+(null===item_id_to_edit?"added":"saved")+"! "+(null!==m?" Start uploading "+$core.lcfirst(m.title)+"...":"Redirecting..."));var _=function(){$core.uri.redirect(null!==item_id_to_edit?$core.isDefined(dynamic_item_options.save.edit.success.redirect)?dynamic_item_options.save.edit.success.redirect:"":$core.isDefined(dynamic_item_options.save.add.success.redirect)?dynamic_item_options.save.add.success.redirect:"")},u=function(){e.setLoaderText("We're all set! Redirecting...")};if(c){var f=0,v=function(t){var i=o[t],r='[name="'+i.form.name+'"]',n=function(){f++,f===l?(u(),_()):l>f&&v(f)};if("image"===i.form.type){var s=$core.form.file_upload.init(r,{progressBarType:$core.form.file_upload.PROGRESS_BAR_TYPE_DYNAMIC_ITEM,progressBarKeyword:"mobile image",saveURL:i.form.save_url,allowedFileTypes:i.form.allowed_file_types,data:{id:a,column_id:i.id},onProgress:function(t){e.setLoaderText("Uploading "+$core.lcfirst(i.title)+" ("+t+"%)...")},onComplete:function(){n()},onError:function(){n()}});s.start()}};v(0)}else _()},error:function(){e.$loader.hide(),$core.ui.message.error("Could not save "+dynamic_item_options.identifier.singular+"."),"string"==typeof e.$save_button.data("default_text")&&e.$save_button.text(e.$save_button.data("default_text")),e.$save_button.prop("disabled",!1)}}),!1}}),e.$tabs=$(e.tabs_selector),1===e.$tabs.length&&$(e.tabs_selector).find(".item").tab()}},setLoaderText:function(e){this.$loader_text.html(e)}};
function Core(){}Core.prototype={options:{csrf_token:null,uri:{base_url:null},message:{engine:null},dynamic_table:{manage_dropdown_settings:{transition:"drop",duration:125}}},uri:null,ui:null,ajax:null,form:null,dynamic_table:null,dynamic_item:null,init:function(t){"object"==typeof t&&(this.options=$.extend(this.options,t)),this.uri=new Core_URI,this.ajax=new Core_Ajax,this.ui=new Core_UI,this.ui.init(),this.form=new Core_Form,this.form.init(),this.dynamic_table=new Core_DynamicTable,this.dynamic_table.init(),this.dynamic_item=new Core_DynamicItem,this.dynamic_item.init()},afterDomInit:function(){this.ui.afterDomInit()},isEmpty:function(t){if(null===t)return!0;if(this.isArray(t)||this.isString(t))return 0===t.length;for(var n in t)if(t.hasOwnProperty(n)&&this.has(t,n))return!1;return!0},isUndefined:function(t){return void 0==t},isDefined:function(t){return!this.isUndefined(t)},exists:function(t){return t.length>0},isObject:function(t){return t===Object(t)},isArray:Array.isArray||function(t){return"[object Array]"==Object.prototype.toString.call(t)},inArray:function(t,n){return-1!==$.inArray(t,n)},isFunction:function(t){return"function"==typeof t},isString:function(t){return"[object String]"===Object.prototype.toString.call(t)},isNumber:function(t){return!isNaN(t)},isInteger:function(t){return"[object Number]"===Object.prototype.toString.call(t)},has:function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},log:function(t){window.console&&console.log("Core: "+t)},isEmail:function(t){var n=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return t.length&&n.test(t)},getUnixTimestamp:function(){return Date.now||(Date.now=function(){return+new Date}),Date.now()},round:function(t,n){return Math.round(t*Math.pow(10,n))/Math.pow(10,n)},formatSize:function(t){return t>=1073741824?this.round(t/1073741824,2)+" GB":t>=1048576?this.round(t/1048576,2)+" MB":t>=1024?this.round(t/1024,0)+" KB":t+" B"},escape:function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},shake:function(t,n,r){for(var e=0;n>e;e++)t.css("postion","relative").animate({"margin-left":"+="+(r=-r)+"px"},50)},format:function(t){var n=Array.prototype.slice.call(arguments,1);return t.replace(/{(\d+)}/g,function(t,r){return"undefined"!=typeof n[r]?n[r]:t})},implode:function(t,n,r){var e="",i="",o="";if(r=r||null,1===arguments.length&&(n=t,t=""),"object"==typeof n){if("[object Array]"===Object.prototype.toString.call(n)&&null===r)return n.join(t);var u=n.length;for(e in n)i+=o+n[e],o=u-2>e?t:r;return i}return n},getObjectSize:function(t){var n,r=0;for(n in t)t.hasOwnProperty(n)&&r++;return r},ucfirst:function(t){return t.charAt(0).toUpperCase()+t.slice(1)},lcfirst:function(t){return t.charAt(0).toLowerCase()+t.slice(1)}};